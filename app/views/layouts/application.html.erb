<!DOCTYPE html>
<html>
  <head>
    <title>Itutor</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
      <%= link_to('Itutor', root_path, class: 'navbar-brand mx-2') %>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse d-lg-flex justify-content-end" id="navbarSupportedContent">
        <% if user_signed_in?%>
          <ul class="navbar-nav" >
            <% if current_user.has_role?(:tutor) %>
              <li class="nav-item p-lg-2">
                <%= link_to '+ Listing', new_listing_path, class: 'btn btn-primary' %>
              </li>
            <% end %>
            <li class="nav-item dropdown p-lg-1 me-3">
              <a class="btn btn-light dropdown-toggle d-flex align-items-center" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                <% if current_user.profile_picture.attached? %>
                  <%= cl_image_tag current_user.profile_picture.key, class: 'rounded-circle', crop: :fill, height: 30, aspect_ratio: '1:1', cloud_name: 'dakvf2jcu' %>
                <% end %>
                <div class="ps-2">
                  <%= current_user.name %>
                </div>
              </a>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                <li class="nav-item">
                  <%= link_to 'View Profile', user_path(current_user), class: 'btn w-100' %>
                </li>
                <hr class="my-0"/>
                <li class="nav-item">
                  <%= link_to 'Schedule', bookings_path, class: 'btn w-100' %>
                </li>
                <li class="nav-item">
                  <%= link_to 'Watchlist', watchlist_index_path, class: 'btn w-100' %>
                </li>
                <hr class="my-0"/>
                <li class="nav-item">
                  <%= link_to 'Account', edit_user_registration_path, class: 'btn w-100' %>
                </li>
                <% if current_user.made_reviews.present? %>
                  <li class="nav-item">
                    <%= link_to 'My Reviews', reviews_path, class: 'btn w-100' %>
                  </li>
                <% end %>
                <hr class="my-0"/>
                <li class="nav-item">
                  <%= button_to 'Logout', destroy_user_session_path, class: 'btn w-100', method: :delete, form: { data: { turbo_confirm: "Are you sure you want to log out? " } } %>
                </li>
              </ul>
            </li>
          </ul>
        <% else %>
          <div class="btn-toolbar">
            <%= link_to 'Sign Up', new_user_registration_path, class: 'btn btn-light m-1 p-lg-2 w-100' %>
          </div>
          <div class="btn-toolbar">
            <%= link_to 'Login', new_user_session_path, class: 'btn btn-light m-1 p-lg-2 w-100' %>
          </div>
        <% end %>
      </nav>
      <% if notice %>
        <p class="alert alert-info notice" role="alert"><%= notice.html_safe %></p>
      <% end %>
      <% if alert %>
        <p class="alert alert-danger" role="alert"><%= alert.html_safe %></p>
      <% end %>
      <%= yield %>
    </body>
  </html>
